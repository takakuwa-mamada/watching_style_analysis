# ãƒãƒƒãƒãƒ³ã‚°å•é¡Œã®è§£æ±ºç­–ã‚µãƒãƒªãƒ¼

## ğŸ¯ å•é¡Œã®æ ¹æœ¬åŸå› 

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ
```
[DEBUG] Pair 1: event0 vs event0
  - top_words_A: ['gente', 'vamos', 'mi']           (ã‚¹ãƒšã‚¤ãƒ³èª)
  - top_words_B: ['hermano', 'bendiciones', '...]   (ã‚¹ãƒšã‚¤ãƒ³èª)
  - Jaccard similarity: 0.0000
```

**æ ¹æœ¬åŸå› ï¼š**
1. **å„é…ä¿¡è€…ãŒç‹¬ç«‹ã—ãŸBERTopicã§ãƒˆãƒ”ãƒƒã‚¯åˆ†é¡** â†’ ãƒˆãƒ”ãƒƒã‚¯IDãŒãƒãƒ©ãƒãƒ©
2. **é…ä¿¡è€…ã”ã¨ã«ç•°ãªã‚‹èªå½™ã‚’ä½¿ç”¨**ï¼ˆã‚¹ãƒšã‚¤ãƒ³èªvsæ—¥æœ¬èªã€é…ä¿¡è€…å›ºæœ‰ã®è¡¨ç¾ï¼‰
3. **Jaccardä¿‚æ•°ï¼ˆèªå½™ã®é‡ãªã‚Šï¼‰= 0.0** â†’ æ„å‘³çš„ã«åŒã˜å†…å®¹ã§ã‚‚ãƒãƒƒãƒãƒ³ã‚°ä¸å¯èƒ½
4. **æ™‚é–“å¸¯ãŒåŒã˜ã§åŒã˜è©¦åˆã®å ´é¢ã«ã¤ã„ã¦ç››ã‚Šä¸ŠãŒã£ã¦ã„ã¦ã‚‚ã€èªå½™ãŒç•°ãªã‚‹ãŸã‚æ¤œå‡ºã§ããªã„**

## âœ… è§£æ±ºç­–ï¼šåŸ‹ã‚è¾¼ã¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒãƒ³ã‚°

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®å¤‰æ›´
**æ—§æ–¹å¼ï¼ˆå¤±æ•—ï¼‰ï¼š**
```
1. Time proximity check (Â±15 bins)
2. Jaccard similarity (èªå½™ã®é‡ãªã‚Š) â†’ 0.0ã§å…¨ã¦å¤±æ•—
3. Embedding similarity (åˆ°é”ä¸å¯)
```

**æ–°æ–¹å¼ï¼ˆæˆåŠŸï¼‰ï¼š**
```
1. Time proximity check (Â±15 bins)
2. Embedding similarity (æ„å‘³çš„é¡ä¼¼åº¦) â†’ ãƒ¡ã‚¤ãƒ³æ¡ä»¶
3. Jaccard similarity (è£œåŠ©çš„ãªå“è³ªãƒã‚§ãƒƒã‚¯)
```

### å®Ÿè£…ã®å¤‰æ›´ç‚¹

#### 1. ãƒãƒƒãƒãƒ³ã‚°é †åºã®å¤‰æ›´
```python
# æ™‚é–“ãƒã‚§ãƒƒã‚¯ï¼ˆæœ€é€Ÿï¼‰
if bin_diff > time_th:
    continue

# åŸ‹ã‚è¾¼ã¿é¡ä¼¼åº¦ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ¡ã‚¤ãƒ³æ¡ä»¶ï¼‰
if embed_th is not None:
    if embedding_similarity < embed_th:
        continue
    # ã“ã“ã¾ã§åˆ°é” = æ„å‘³çš„ã«é¡ä¼¼

# Jaccardé¡ä¼¼åº¦ï¼ˆè£œåŠ©çš„ï¼‰
# åŸ‹ã‚è¾¼ã¿ãƒãƒƒãƒãƒ³ã‚°ãŒæœ‰åŠ¹ãªå ´åˆã¯å‚è€ƒå€¤ã¨ã—ã¦ä½¿ç”¨
```

#### 2. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰æ›´
```python
# ä¿®æ­£å‰
--word-match-th: 0.1  (èªå½™ãƒ™ãƒ¼ã‚¹ã€ãƒ¡ã‚¤ãƒ³æ¡ä»¶)
--embedding-match-th: None  (ç„¡åŠ¹)

# ä¿®æ­£å¾Œ
--word-match-th: 0.05  (åŸ‹ã‚è¾¼ã¿ä½¿ç”¨æ™‚ã¯è£œåŠ©çš„)
--embedding-match-th: 0.65  (æ„å‘³ãƒ™ãƒ¼ã‚¹ã€ãƒ¡ã‚¤ãƒ³æ¡ä»¶) â˜…æ¨å¥¨
```

## ğŸ“Š çµæœ

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ
```
ä½¿ç”¨ãƒ‡ãƒ¼ã‚¿: data/chat (3ãƒ•ã‚¡ã‚¤ãƒ«ã€78ã‚¤ãƒ™ãƒ³ãƒˆ)
ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: word-match-th=0.05, time-match-th=15, embedding-match-th=0.6

çµæœ:
- Total pairs compared: 1980
- Matched: 126 âœ… (æ—§æ–¹å¼ã§ã¯0)
- matched_event_presence.png ç”ŸæˆæˆåŠŸ âœ…
```

### ãƒãƒƒãƒãƒ³ã‚°æˆåŠŸç‡
- **æ—§æ–¹å¼ï¼ˆJaccardã®ã¿ï¼‰**: 0/1980 = 0%
- **æ–°æ–¹å¼ï¼ˆåŸ‹ã‚è¾¼ã¿å„ªå…ˆï¼‰**: 126/1980 = 6.4%

ã“ã‚Œã¯å¦¥å½“ãªå€¤ã§ã™ï¼š
- ç•°ãªã‚‹é…ä¿¡è€…ï¼ˆç•°ãªã‚‹è¨€èªãƒ»è¡¨ç¾ï¼‰
- æ™‚é–“å¸¯ãŒÂ±15binsä»¥å†…ã«é™å®š
- æ„å‘³çš„ã«æœ¬å½“ã«é¡ä¼¼ã—ã¦ã„ã‚‹å ´åˆã®ã¿ãƒãƒƒãƒ

## ğŸš€ ä»Šå¾Œã®æ¨å¥¨è¨­å®š

### game4ãƒ‡ãƒ¼ã‚¿ç”¨ï¼ˆ4é…ä¿¡è€…ï¼šUKã€æ—¥æœ¬Ã—2ã€ãƒ–ãƒ©ã‚¸ãƒ«ï¼‰

#### é«˜é€Ÿãƒ†ã‚¹ãƒˆç”¨
```bash
python event_comparison.py \
  --folder data/football/game4 \
  --pattern "*.csv" \
  --time-bins 50 \
  --n-events 3 \
  --focus-top 5 \
  --word-match-th 0.05 \
  --time-match-th 15 \
  --embedding-match-th 0.6 \
  --emoji-topk 5
```

#### ãƒãƒ©ãƒ³ã‚¹å‹ï¼ˆæ¨å¥¨ï¼‰â˜…
```bash
python event_comparison.py \
  --folder data/football/game4 \
  --pattern "*.csv" \
  --time-bins 100 \
  --n-events 5 \
  --focus-top 10 \
  --word-match-th 0.05 \
  --time-match-th 15 \
  --embedding-match-th 0.65 \
  --emoji-topk 10
```

#### é«˜ç²¾åº¦å‹ï¼ˆå­¦ä¼šç™ºè¡¨ç”¨ï¼‰
```bash
python event_comparison.py \
  --folder data/football/game4 \
  --pattern "*.csv" \
  --time-bins 150 \
  --n-events 8 \
  --focus-top 15 \
  --word-match-th 0.05 \
  --time-match-th 12 \
  --embedding-match-th 0.7 \
  --emoji-topk 15 \
  --save-json
```

## ğŸ“ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

### embedding-match-thï¼ˆæœ€é‡è¦ï¼‰
| å€¤ | ãƒãƒƒãƒãƒ³ã‚°å‚¾å‘ | æ¨å¥¨ç”¨é€” |
|---|---|---|
| 0.5-0.6 | ç·©ã„ã€å¤šããƒãƒƒãƒ | æ¢ç´¢çš„åˆ†æ |
| **0.6-0.7** | **ãƒãƒ©ãƒ³ã‚¹å‹** | **å­¦ä¼šç™ºè¡¨ï¼ˆæ¨å¥¨ï¼‰** â˜… |
| 0.7-0.8 | å³å¯†ã€å°‘æ•°ãƒãƒƒãƒ | é«˜ç²¾åº¦åˆ†æ |

### word-match-th
- åŸ‹ã‚è¾¼ã¿ãƒãƒƒãƒãƒ³ã‚°ä½¿ç”¨æ™‚ï¼š**0.05æ¨å¥¨**ï¼ˆè£œåŠ©çš„ãªå½¹å‰²ï¼‰
- Jaccardã®ã¿ä½¿ç”¨æ™‚ï¼š0.1-0.15ï¼ˆãŸã ã—å¤šè¨€èªã§ã¯æ©Ÿèƒ½ã—ãªã„ï¼‰

### time-match-th
- å€¤ãŒå¤§ãã„ï¼šæ™‚é–“ãŒãšã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã‚‚ãƒãƒƒãƒ
- æ¨å¥¨å€¤ï¼š
  - time-bins=50ã®å ´åˆï¼š20-30
  - time-bins=100ã®å ´åˆï¼š15-20
  - time-bins=150ã®å ´åˆï¼š10-15

## ğŸ“ æŠ€è¡“çš„ãªèƒŒæ™¯

### ãªãœåŸ‹ã‚è¾¼ã¿ãŒå¿…è¦ã‹

**BERTopicã®ç‰¹æ€§ï¼š**
- å„é…ä¿¡ã”ã¨ã«ç‹¬ç«‹ã—ã¦ãƒˆãƒ”ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰
- ãƒˆãƒ”ãƒƒã‚¯IDã¯é…ä¿¡é–“ã§å¯¾å¿œã—ã¦ã„ãªã„
- åŒã˜è©¦åˆã®åŒã˜å ´é¢ã§ã‚‚ã€é…ä¿¡è€…ã”ã¨ã«ç•°ãªã‚‹ãƒˆãƒ”ãƒƒã‚¯ID

**èªå½™ã®å¤šæ§˜æ€§ï¼š**
```
æ—¥æœ¬èªé…ä¿¡: ã€Œã™ã”ã„ã€ã€Œã‚´ãƒ¼ãƒ«ã€ã€Œã‚„ã°ã„ã€
è‹±èªé…ä¿¡: "amazing" "goal" "wow"
ã‚¹ãƒšã‚¤ãƒ³èª: "increÃ­ble" "gol" "vamos"
```
â†’ Jaccardä¿‚æ•° = 0.0ï¼ˆèªå½™ãŒå®Œå…¨ã«ç•°ãªã‚‹ï¼‰

**åŸ‹ã‚è¾¼ã¿ã®åˆ©ç‚¹ï¼š**
- å¤šè¨€èªå¯¾å¿œï¼ˆSentenceTransformerãŒå¤šè¨€èªå¯¾å¿œï¼‰
- æ„å‘³çš„é¡ä¼¼åº¦ã‚’æ‰ãˆã‚‹
- è¡¨ç¾ã®é•ã„ã‚’å¸å

### SentenceTransformerãƒ¢ãƒ‡ãƒ«
ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«: `paraphrase-multilingual-MiniLM-L12-v2`
- 50ä»¥ä¸Šã®è¨€èªå¯¾å¿œ
- 384æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«
- é«˜é€Ÿï¼ˆæ—§ãƒ¢ãƒ‡ãƒ«ã‚ˆã‚Š50-70%é€Ÿã„ï¼‰
- ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã§æ¯”è¼ƒ

## ğŸ“ ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

### å­¦ä¼šç™ºè¡¨ã§ä½¿ç”¨ã™ã‚‹ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«
1. **matched_event_presence.png** - é¡ä¼¼ãƒˆãƒ”ãƒƒã‚¯ã®æ™‚é–“å¸¯åˆ¥æ¯”è¼ƒï¼ˆãƒ¡ã‚¤ãƒ³å›³è¡¨ï¼‰
2. **emoji_timelines/*.png** - å„é…ä¿¡è€…ã®çµµæ–‡å­—ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆè£œåŠ©è³‡æ–™ï¼‰
3. **similar_event_comparison_results.csv** - å®šé‡ãƒ‡ãƒ¼ã‚¿ï¼ˆè¡¨ãƒ»çµ±è¨ˆç”¨ï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«
- `similar_event_details.csv` - ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°æƒ…å ±
- `similar_event_comments.json` - ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹ï¼ˆäº‹ä¾‹ç´¹ä»‹ç”¨ï¼‰
- `emoji_rankings.csv` - çµµæ–‡å­—ãƒ©ãƒ³ã‚­ãƒ³ã‚°

## âš ï¸ æ³¨æ„äº‹é …

### åŸ‹ã‚è¾¼ã¿ãƒãƒƒãƒãƒ³ã‚°ç„¡åŠ¹åŒ–ã®å ´åˆ
```bash
--embedding-match-th None  # ã¾ãŸã¯æœªæŒ‡å®š
```
â†’ Jaccardã®ã¿ã§ãƒãƒƒãƒãƒ³ã‚°
â†’ **å¤šè¨€èªé…ä¿¡ã§ã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“**

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- åŸ‹ã‚è¾¼ã¿è¨ˆç®—ã¯ãƒ¡ãƒ¢ãƒªã‚’æ¶ˆè²»
- å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã®å ´åˆï¼š
  1. `--n-events`ã‚’æ¸›ã‚‰ã™
  2. `--focus-top`ã‚’æ¸›ã‚‰ã™
  3. `--time-bins`ã‚’æ¸›ã‚‰ã™

## ğŸ”„ ä»Šå¾Œã®æ”¹å–„æ¡ˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆREFACTORING_PLAN.mdå‚ç…§ï¼‰
- åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- 2å›ç›®ä»¥é™ã®å®Ÿè¡Œã‚’é«˜é€ŸåŒ–

### 2. ãƒãƒƒãƒãƒ³ã‚°å“è³ªã‚¹ã‚³ã‚¢
```python
quality_score = embedding_sim * 0.7 + jaccard_sim * 0.3
```
- åŸ‹ã‚è¾¼ã¿é¡ä¼¼åº¦ã¨Jaccardã‚’çµ„ã¿åˆã‚ã›ãŸç·åˆã‚¹ã‚³ã‚¢

### 3. æ™‚é–“å¸¯ã®å‹•çš„èª¿æ•´
- è©¦åˆåºç›¤ï¼štime-match-thå°ã•ã‚
- è©¦åˆçµ‚ç›¤ï¼štime-match-thå¤§ãã‚
- å±•é–‹ãŒé€Ÿã„å ´é¢ã§ã®èª¿æ•´

## ğŸ“š å‚è€ƒè³‡æ–™

- `RUN_COMMANDS.md` - å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰é›†
- `CONFERENCE_STRATEGY.md` - å­¦ä¼šç™ºè¡¨æˆ¦ç•¥
- `CHECKLIST.md` - æˆæœç‰©ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- `REFACTORING_PLAN.md` - é•·æœŸæ”¹å–„è¨ˆç”»
