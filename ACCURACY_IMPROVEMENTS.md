# 精度向上実装計画

## 1. トピック分類精度の改善

### 1.1 Jaccard閾値の動的調整
**問題**: 固定閾値0.6は厳しすぎる可能性
**解決策**: 
- トピックサイズに応じた適応的閾値
- 小トピック（<10単語）: 閾値0.4
- 中トピック（10-30単語）: 閾値0.5
- 大トピック（>30単語）: 閾値0.6

### 1.2 トピック単語の品質向上
**問題**: ストップワードや意味のない単語が含まれる
**解決策**:
- 多言語ストップワード辞書の拡張
- 最小単語長フィルタ（2文字以上）
- 頻度ベースフィルタ（過度に一般的/稀な単語を除外）

### 1.3 類似トピックのマージ改善
**問題**: 意味的に同じだが表記が異なるトピックが分離
**解決策**:
- 埋め込みベースの類似度も考慮
- Jaccard + 埋め込み類似度のハイブリッド

## 2. イベントマッチング精度の改善

### 2.1 時間窓の適応的調整
**問題**: 固定15秒は短すぎる/長すぎる場合がある
**解決策**:
- コメント密度に応じた動的調整
- 高密度（>100コメント/分）: 10秒
- 中密度（30-100コメント/分）: 15秒
- 低密度（<30コメント/分）: 20秒

### 2.2 埋め込み類似度の信頼度スコア
**問題**: 全ての埋め込み類似度を同等に扱っている
**解決策**:
- トピックサイズで重み付け（大きいトピック=高信頼度）
- コメント数で重み付け（多いコメント=高信頼度）

### 2.3 偽陽性の削減
**問題**: 無関係なイベントがマッチングされる
**解決策**:
- 最小コメント数閾値（各イベント5コメント以上）
- トピック語の最小重複数（2単語以上）
- 時系列パターンの類似度チェック

## 3. 距離計算の精度向上

### 3.1 語彙正規化の強化
**問題**: 同じ意味の異なる表記が別単語として扱われる
**解決策**:
- 繰り返し文字の正規化（"goallllll" → "goal"）
- 大文字小文字の統一
- 数字の正規化（"2-1" → "goal_score"）

### 3.2 言語固有の処理
**問題**: 各言語の特性を考慮していない
**解決策**:
- 日本語: 助詞の除去、動詞の正規化
- ポルトガル語: アクセント記号の正規化
- 英語: 単数複数の統一

### 3.3 JS距離のエッジケース処理
**問題**: データ不足でNaNが発生
**解決策**:
- 最小データ数チェック（各側10単語以上）
- スムージング処理（Laplace smoothing）
- 欠損値の適切な処理

## 4. 評価指標の追加

### 4.1 マッチング品質スコア
- トピック一致度
- 時間的近接性
- コメント数の均衡性

### 4.2 信頼度スコア
- 各マッチングに信頼度スコアを付与
- 低信頼度マッチングを自動除外

## 実装優先順位

1. **最優先**: トピック単語品質向上（1.2）
2. **高**: 繰り返し文字正規化（3.1）
3. **高**: 最小コメント数閾値（2.3）
4. **中**: 適応的Jaccard閾値（1.1）
5. **中**: 時間窓動的調整（2.1）
6. **低**: ハイブリッドマージ（1.3）
