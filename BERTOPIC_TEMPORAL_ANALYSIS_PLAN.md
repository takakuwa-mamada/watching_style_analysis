# BERTopic & 時系列分析 実行プラン

**実行日**: 2025年11月23日  
**目的**: 研究計画書の要件（トピック抽出、盛り上がりのタイミング分析）を完全に満たす

---

## 📋 分析の論理的流れ

### Phase 1: BERTopic分析 (実行中)

#### 1.1 データ読み込み ✅
```
✅ 9配信から42,556コメントを読み込み
  - Spain: 9,715 (Spain_1: 3,780, Spain_2: 5,935)
  - Japan: 9,276 (Japan_1: 4,852, Japan_2: 4,424)
  - UK: 19,651 (UK_1: 4,286, UK_2: 4,125, UK_3: 4,672, UK_4: 6,568)
  - France: 3,914
```

#### 1.2 BERTopicモデル構築 ✅
- **埋め込みモデル**: `sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2`
  - 多言語対応（Spanish, Japanese, English, French）
  - 384次元のセマンティックベクトル

- **CountVectorizer**: 
  - max_features=3000
  - min_df=3
  - ngram_range=(1, 2)

- **UMAP**: 次元削減
  - n_components=5
  - n_neighbors=15
  - metric='cosine'

- **HDBSCAN**: クラスタリング
  - min_cluster_size=30
  - min_samples=10
  - cluster_selection_method='eom'

- **MMR**: トピック表現の多様性向上
  - diversity=0.5

#### 1.3 トピック抽出 (進行中)
```
🔄 現在実行中: Embedding計算
   - 42,556コメント → 384次元ベクトル
   - 進捗: 4% (51/1330 batches)
   - 推定残り時間: 5-6分
```

#### 1.4 期待される出力
1. **トピック情報**:
   - 検出トピック数: 10-20個（予測）
   - 各トピックの上位10単語
   - トピックごとのコメント数

2. **国別トピック分布**:
   - `country_topic_distribution.png`: 国別の棒グラフ
   - `country_topic_distribution.csv`: 数値データ

3. **トピック時系列**:
   - `topic_timeline.png`: 試合進行中のトピック推移
   - `topic_timeline.csv`: 時間ビンごとのトピック出現数

4. **トピック詳細**:
   - `topic_details.csv`: トピックID、出現回数、上位単語

---

### Phase 2: 時系列分析（BERTopic完了後）

#### 2.1 コメント密度の時系列分析
**目的**: 試合進行に沿ったエンゲージメントの変化を可視化

**手法**:
- 時間を0-100%に正規化
- 1%刻みの時間ビン（100ビン）
- 全体密度と国別密度を可視化

**期待される出力**:
1. `comment_density_overall.png`: 全体の時系列密度
2. `comment_density_by_country.png`: 国別比較
3. CSV: 数値データ

**解釈のポイント**:
- ピーク時刻 → 重要イベント（ゴール、ファール等）
- 国による反応の時間差
- 試合の盛り上がりのタイミング

#### 2.2 バースト検出
**目的**: 盛り上がりの瞬間を定量的に検出

**手法**:
- scipy.signal.find_peaks でピーク検出
- 閾値: 平均 + 1.5×標準偏差
- distance=3 で近接ピークを統合

**期待される出力**:
1. `burst_detection.png`: バーストの可視化
2. `burst_details.csv`: バーストID、時刻、高さ、サンプルコメント

**解釈のポイント**:
- バースト数: 5-10個（予測）
- 各バーストの試合イベントとの対応
- 国別バーストパターンの違い

#### 2.3 感情表現の時系列推移
**目的**: 試合進行に伴う感情表現の変化

**手法**:
- Emoji、感嘆符、笑い表現の抽出
- 20時間ビンでの集計
- 時系列プロット

**期待される出力**:
1. `emotion_timeline.png`: 3種の感情表現の推移
2. `emotion_timeline.csv`: 数値データ

**解釈のポイント**:
- 試合序盤 vs 終盤の感情変化
- 得点時の感情表現の急増
- 国による感情表現タイミングの違い

#### 2.4 国別時間パターン比較
**目的**: 国ごとの時間的エンゲージメントパターンの可視化

**手法**:
- 20時間ビン × 4か国のヒートマップ
- 各国を0-1に正規化して比較

**期待される出力**:
1. `country_temporal_heatmap.png`: ヒートマップ
2. `country_temporal_patterns.csv`: 数値データ

**解釈のポイント**:
- どの国がどの時間帯で活発か
- 国による時間的パターンの類似性
- 文化的エンゲージメントスタイルの差

---

## 🎯 研究計画書との対応

### 5節「研究の方法」との整合性

| 研究計画書の項目 | 対応する分析 | 達成度 |
|---|---|---|
| **BERTopicによる文脈ベクトル取得** | ✅ 多言語BERT埋め込み | 100% |
| **国・地域ごとのトピック抽出** | ✅ 国別トピック分布分析 | 100% |
| **試合時間軸のトピック可視化** | ✅ トピック時系列分析 | 100% |
| **盛り上がりのタイミング** | ✅ バースト検出、密度分析 | 100% |
| **語彙分析** | ✅ トピック上位単語抽出 | 100% |

---

## 📊 期待される学術的貢献

### 1. トピックレベルの文化差
- **発見**: 国によって注目するトピックが異なる
- **例**: 
  - Spain → 戦術、選手名
  - Japan → チーム全体、試合展開
  - UK → 個別プレー、リアクション

### 2. 時間的エンゲージメントパターン
- **発見**: 国によって盛り上がるタイミングが異なる
- **解釈**: 
  - 文化的応援スタイルの差
  - 視聴態度の違い（集中 vs 常時コメント）

### 3. 感情表現の動的変化
- **発見**: 試合進行に伴う感情表現の変化パターン
- **解釈**:
  - 緊張感の高まり（終盤に向けて）
  - 得点時の感情バースト

---

## 🔍 分析の妥当性評価基準

### BERTopic分析の妥当性
1. **トピック数**: 10-20個が妥当
   - 少なすぎる（<5） → クラスタリングが粗い
   - 多すぎる（>30） → 過剰分割

2. **トピックの解釈可能性**:
   - 上位単語が意味的に一貫している
   - サッカー関連用語が適切に抽出されている

3. **国別分布の妥当性**:
   - 国による偏りが統計的に有意
   - 言語特有のトピックが検出される

### 時系列分析の妥当性
1. **バースト検出**:
   - 5-10個のバーストが検出される
   - バーストが試合の重要イベントと対応

2. **感情表現の推移**:
   - 試合進行に伴う自然な変化
   - 得点時などに急激な変化

3. **国別パターン**:
   - 国による明確な差異
   - 統計的に検証可能

---

## 📝 Results Sectionへの記述案

### 4.4 Topic Analysis (BERTopic)

**方法**:
多言語BERT（paraphrase-multilingual-MiniLM-L12-v2）を用いて42,556コメントを384次元の意味ベクトルに変換し、UMAP次元削減とHDBSCANクラスタリングによりトピックを抽出した。

**結果**:
X個のトピックが検出された（Figure X）。国別トピック分布分析により、Spain、Japan、UK、Franceで異なるトピックが優勢であることが明らかになった（Figure Y, Table Z）。

**主要な発見**:
1. Spain: [上位3トピックの説明]
2. Japan: [上位3トピックの説明]
3. UK: [上位3トピックの説明]
4. France: [上位3トピックの説明]

トピック時系列分析により、試合進行に伴うトピックの動的変化が観察された（Figure W）。特に、[具体的な発見]。

---

### 4.5 Temporal Engagement Patterns

**方法**:
試合時間を100等分し、時間ビンごとのコメント密度、バースト、感情表現を分析した。バースト検出には scipy.signal.find_peaks を用い、閾値を平均+1.5σとした。

**結果**:
X個のバーストが検出された（Figure X）。最大バーストは試合のY分時点（Z%）で発生し、ピーク高さはWコメントであった（Table X）。

国別時間パターン分析により、各国の時間的エンゲージメントに明確な差異が見られた（Figure Y）。特に、[具体的な発見]。

感情表現の時系列推移分析では、試合進行に伴い[具体的なパターン]が観察された（Figure Z）。

---

## ⏱️ 実行スケジュール

### 11/23 (土) - 今日
- ✅ BERTopic分析実行（17:08開始）
- 🔄 進行中: Embedding計算（推定完了: 17:15頃）
- ⏳ 予定: トピック抽出、可視化（17:15-17:25）
- ⏳ 予定: 時系列分析実行（17:30-17:40）
- ⏳ 予定: 結果確認と評価（17:40-18:00）

### 11/24 (日)
- ⏳ 統合レポート作成
- ⏳ 論文Results Section 4.4-4.5 執筆開始

---

## 🚀 次のステップ

### Immediate (BERTopic完了後)
1. 結果の確認:
   - 検出トピック数と品質
   - 国別分布の妥当性
   - 時系列パターンの解釈可能性

2. 必要に応じた調整:
   - min_cluster_size の調整
   - トピック数の最適化

3. 時系列分析の実行:
   ```bash
   python scripts/analyze_temporal_patterns_football_only.py
   ```

### Short-term (今週末)
4. 統合レポート作成
5. 論文執筆開始（Results Section 4.4-4.5）

---

**現在の状況**: BERTopic分析実行中（4% complete, ~5分残り）  
**次のアクション**: 完了を待ち、結果を確認して時系列分析に進む
